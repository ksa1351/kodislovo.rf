<!doctype html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ОГЭ Русский — Задание 1 (грамматическая основа) — тренажёр</title>
  <link rel="stylesheet" href="../../assets/css/control-ui.css">
  <style>
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .top{display:flex;justify-content:space-between;gap:12px;align-items:flex-end;flex-wrap:wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px}
    .task{border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:12px;margin-top:12px}
    .task h3{margin:0 0 10px;font-size:16px}
    .answers{display:flex;gap:8px;flex-wrap:wrap}
    .ansbtn{min-width:44px;height:40px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);color:inherit;cursor:pointer;font-weight:900}
    .ansbtn.active{background:rgba(255,255,255,.16)}
    .subtle{color:var(--muted)}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);color:var(--muted);font-size:13px}
    .two{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:980px){ .two{grid-template-columns:460px 1fr} }
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid rgba(255,255,255,.10);padding:10px 8px;vertical-align:top}
    th{color:var(--muted);text-align:left;font-weight:800}
    code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1 style="margin:0 0 6px">ОГЭ Русский — Задание 1</h1>
        <div class="sub">Тренажёр: <b>грамматическая основа</b> (выберите верные варианты 1–5 для каждого задания).</div>
      </div>
      <div class="row">
        <a class="kd-btn secondary" href="../index.html" style="text-decoration:none">← Русский язык</a>
        <label class="pill">Тема <input id="themeToggle" type="checkbox" aria-label="Переключить тему"></label>
      </div>
    </div>

    <div class="two" style="margin-top:14px">
      <div class="card">
        <div style="font-weight:900;font-size:18px">Управление</div>
        <div class="subtle" style="margin-top:6px">
          Ответы сохраняются на этом устройстве автоматически.
        </div>

        <div class="row" style="margin-top:12px">
          <button id="btnCheck" class="kd-btn" type="button">Проверить</button>
          <button id="btnDownload" class="kd-btn secondary" type="button">Скачать ответы (JSON)</button>
          <button id="btnClear" class="kd-btn secondary" type="button">Очистить</button>
        </div>

        <div class="row" style="margin-top:12px">
          <div class="pill">Выполнено: <b id="doneCount">0</b>/<span id="totalCount">21</span></div>
          <div class="pill">Точный балл: <b id="score">—</b></div>
        </div>

        <details style="margin-top:12px">
          <summary style="cursor:pointer;font-weight:900">Как пользоваться</summary>
          <div class="sub" style="margin-top:8px;line-height:1.4">
            Для каждого задания отметьте кнопки <b>1–5</b>. Можно выбрать несколько вариантов.
            Нажмите «Проверить», чтобы увидеть общий результат (без показа ответов по заданиям).
            <br><br>
            Файл JSON можно отправить учителю или сохранить как черновик.
          </div>
        </details>
      </div>

      <div class="card">
        <div style="font-weight:900;font-size:18px">Задания</div>
        <div id="tasks"></div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div style="font-weight:900;font-size:18px">Результат</div>
      <div id="result" class="sub" style="margin-top:10px">Пока не проверено.</div>
    </div>

    <div class="card" style="margin-top:14px">
      <div style="font-weight:900;font-size:18px">Технически</div>
      <div class="sub" style="margin-top:10px">
        Локальный ключ хранения: <code id="lsKey"></code>
      </div>
    </div>
  </div>

<script>
(() => {
  const LS_KEY = "kd_oge_rus_task1_v1_answers";
  const TOTAL = 21;

  // ===== theme =====
  function applyTheme(t){
    const theme = (t === "light") ? "light" : "dark";
    document.documentElement.dataset.theme = theme;
    localStorage.setItem("kd-theme", theme);
    const toggle = document.getElementById("themeToggle");
    if (toggle) toggle.checked = theme === "light";
  }
  applyTheme(localStorage.getItem("kd-theme") || "dark");
  document.getElementById("themeToggle").addEventListener("change", (e) => {
    applyTheme(e.target.checked ? "light" : "dark");
  });

  // ===== key (эталон) =====
  const correct = {
    1:[1,3,4], 2:[1,3,5], 3:[1,4,5], 4:[1,4], 5:[2,3,4],
    6:[1,2,3,5], 7:[1,2,4,5], 8:[1,2,3,5], 9:[1,2,3,5], 10:[3,4,5],
    11:[1,4,5], 12:[3,4,5], 13:[1,2,4,5], 14:[1,3,4], 15:[1,4,5],
    16:[1,3,5], 17:[1,2,4,5], 18:[1,2,3,5], 19:[2,3,5], 20:[1,4,5],
    21:[1,2,4,5]
  };

  const tasksDiv = document.getElementById("tasks");
  const doneCount = document.getElementById("doneCount");
  const totalCount = document.getElementById("totalCount");
  const scoreEl = document.getElementById("score");
  const resultEl = document.getElementById("result");
  const lsKeyEl = document.getElementById("lsKey");

  totalCount.textContent = String(TOTAL);
  lsKeyEl.textContent = LS_KEY;

  let answers = {};
  try { answers = JSON.parse(localStorage.getItem(LS_KEY) || "{}") || {}; } catch { answers = {}; }

  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(answers)); }
  function isDone(i){ return Array.isArray(answers[i]) && answers[i].length > 0; }

  function updateStats(){
    let done = 0;
    for (let i=1;i<=TOTAL;i++) if (isDone(i)) done++;
    doneCount.textContent = String(done);
  }

  function render(){
    tasksDiv.innerHTML = "";
    for (let i=1;i<=TOTAL;i++){
      const wrap = document.createElement("div");
      wrap.className = "task";
      wrap.innerHTML = `<h3>Задание ${i}</h3><div class="answers" id="task_${i}"></div>`;
      tasksDiv.appendChild(wrap);

      const row = wrap.querySelector("#task_" + i);
      for (let j=1;j<=5;j++){
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "ansbtn";
        btn.textContent = String(j);
        if (Array.isArray(answers[i]) && answers[i].includes(j)) btn.classList.add("active");

        btn.addEventListener("click", () => {
          if (!Array.isArray(answers[i])) answers[i] = [];
          const idx = answers[i].indexOf(j);
          if (idx >= 0){
            answers[i].splice(idx, 1);
            btn.classList.remove("active");
          } else {
            answers[i].push(j);
            btn.classList.add("active");
          }
          answers[i] = Array.from(new Set(answers[i])).sort((a,b)=>a-b);
          save();
          updateStats();
        });
        row.appendChild(btn);
      }
    }
    updateStats();
  }

  function check(){
    let score = 0;
    for (let i=1;i<=TOTAL;i++){
      const a = (answers[i] || []).slice().sort((a,b)=>a-b).join(",");
      const c = (correct[i] || []).slice().sort((a,b)=>a-b).join(",");
      if (a && a === c) score++;
    }
    scoreEl.textContent = String(score) + " / " + TOTAL;
    resultEl.innerHTML = `Результат: <b>${score}</b> из <b>${TOTAL}</b> (засчитываются только полностью совпавшие ответы).`;
  }

  function download(){
    const payload = { trainer:"oge_rus_task1", savedAt:new Date().toISOString(), answers };
    const data = JSON.stringify(payload, null, 2);
    const blob = new Blob([data], { type:"application/json;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "oge_rus_task1_answers.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(a.href);
  }

  function clearAll(){
    if (!confirm("Очистить все ответы на этом устройстве?")) return;
    answers = {};
    save();
    render();
    scoreEl.textContent = "—";
    resultEl.textContent = "Очищено.";
  }

  document.getElementById("btnCheck").addEventListener("click", check);
  document.getElementById("btnDownload").addEventListener("click", download);
  document.getElementById("btnClear").addEventListener("click", clearAll);

  render();
})();
</script>
</body>
</html>
